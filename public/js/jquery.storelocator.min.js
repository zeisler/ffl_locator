/*
* storeLocator v1.4.8 - jQuery Google Maps Store Locator Plugin
* (c) Copyright 2013, Bjorn Holine (http://www.bjornblog.com)
* Released under the MIT license
* Distance calculation function by Chris Pietschmann: http://pietschsoft.com/post/2008/02/01/Calculate-Distance-Between-Geocodes-in-C-and-JavaScript.aspx
*/

(function(a){a.fn.storeLocator=function(b){var c=a.extend({mapDiv:"map",listDiv:"loc-list",formContainerDiv:"form-container",formID:"user-location",inputID:"address",zoomLevel:12,pinColor:"fe7569",pinTextColor:"000000",lengthUnit:"m",storeLimit:26,distanceAlert:60,dataType:"xml",dataLocation:"locations.xml",listColor1:"ffffff",listColor2:"eeeeee",originMarker:false,originpinColor:"blue",bounceMarker:true,slideMap:true,modalWindow:false,overlayDiv:"overlay",modalWindowDiv:"modal-window",modalContentDiv:"modal-content",modalCloseIconDiv:"close-icon",defaultLoc:false,defaultLat:"",defaultLng:"",autoGeocode:false,maxDistance:false,maxDistanceID:"maxdistance",fullMapStart:false,noForm:false,loading:false,loadingDiv:"loading-map",featuredLocations:false,infowindowTemplatePath:"templates/infowindow-description.html",listTemplatePath:"templates/location-list-description.html",KMLinfowindowTemplatePath:"templates/kml-infowindow-description.html",KMLlistTemplatePath:"templates/kml-location-list-description.html",callbackBeforeSend:null,callbackComplete:null,callbackSuccess:null,callbackModalOpen:null,callbackModalClose:null,jsonpCallback:null,geocodeErrorAlert:"Geocode was not successful for the following reason: ",blankInputAlert:"The input box was blank.",addressErrorAlert:"Unable to find address",autoGeocodeErrorAlert:"Automatic location detection failed. Please fill in your address or zip code.",distanceErrorAlert:"Unfortunately, our closest location is more than ",mileLang:"mile",milesLang:"miles",kilometerLang:"kilometer",kilometersLang:"kilometers"},b);
return this.each(function(){var h=a(this);var e,g;f();function f(){if(c.dataType==="kml"){a.get(c.KMLinfowindowTemplatePath,function(i){var j=i;g=Handlebars.compile(j);
});a.get(c.KMLlistTemplatePath,function(i){var j=i;e=Handlebars.compile(j);d();});}else{a.get(c.infowindowTemplatePath,function(i){var j=i;g=Handlebars.compile(j);
});a.get(c.listTemplatePath,function(i){var j=i;e=Handlebars.compile(j);d();});}}function d(){var i,A,t,n,D,l;var s=[];var j=[];var y=[];var z=[];var w="storeLocator";
function B(){s=[];j=[];y=[];z=[];a(document).off("click."+w,"#"+c.listDiv+" li");}if(c.modalWindow===true){h.wrap('<div id="'+c.overlayDiv+'"><div id="'+c.modalWindowDiv+'"><div id="'+c.modalContentDiv+'">');
a("#"+c.modalWindowDiv).prepend('<div id="'+c.modalCloseIconDiv+'"></div>');a("#"+c.overlayDiv).hide();}if(c.slideMap===true){h.hide();}var k={};if(c.lengthUnit==="km"){k.EarthRadius=6367;
}else{k.EarthRadius=3956;}k.ToRadian=function(r){return r*(Math.PI/180);};k.DiffRadian=function(F,r){return k.ToRadian(r)-k.ToRadian(F);};k.CalcDistance=function(I,H,G,F,r){return r*2*Math.asin(Math.min(1,Math.sqrt((Math.pow(Math.sin((k.DiffRadian(I,G))/2),2)+Math.cos(k.ToRadian(I))*Math.cos(k.ToRadian(G))*Math.pow(Math.sin((k.DiffRadian(H,F))/2),2)))));
};function x(){geocoder=new google.maps.Geocoder();this.geocode=function(r,F){geocoder.geocode({address:r},function(I,H){if(H===google.maps.GeocoderStatus.OK){var G={};
G.latitude=I[0].geometry.location.lat();G.longitude=I[0].geometry.location.lng();F(G);}else{alert(c.geocodeErrorAlert+H);F(null);}});};}function E(){geocoder=new google.maps.Geocoder();
this.geocode=function(F,r){geocoder.geocode({latLng:F},function(I,H){if(H===google.maps.GeocoderStatus.OK){if(I[0]){var G={};G.address=I[0].formatted_address;
r(G);}}else{alert(c.geocodeErrorAlert+H);r(null);}});};}function u(r,F){return Math.round(r*Math.pow(10,F))/Math.pow(10,F);}if(c.defaultLoc===true){var v=new E();
var o=new google.maps.LatLng(c.defaultLat,c.defaultLng);v.geocode(o,function(F){if(F!==null){var r=F.address;p(c.defaultLat,c.defaultLng,r);}else{alert(c.addressErrorAlert);
}});}if(c.fullMapStart===true){p();}if(c.autoGeocode===true){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(q,C);}}function q(F){var G=new E();
var H=new google.maps.LatLng(F.coords.latitude,F.coords.longitude);G.geocode(H,function(I){if(I!==null){var r=I.address;p(F.coords.latitude,F.coords.longitude,r);
}else{alert(c.addressErrorAlert);}});}function C(r){alert(c.autoGeocodeErrorAlert);}function m(H){var G=a("#"+c.inputID).val();if(G===""){alert(c.blankInputAlert);
}else{var F=new x();var r=G;F.geocode(r,function(I){if(I!==null){A=I.latitude;t=I.longitude;p(A,t,G,H);}else{alert(c.addressErrorAlert);}});}}a(function(){function r(G){G.preventDefault();
if(c.maxDistance===true){var F=a("#"+c.maxDistanceID).val();m(F);}else{m();}}if(c.noForm===true){a(document).on("click."+w,"#"+c.formContainerDiv+" #submit",function(F){r(F);
});a(document).on("keyup."+w,function(F){if(F.keyCode===13&&a("#"+c.inputID).is(":focus")){r(F);}});}else{a(document).on("submit."+w,"#"+c.formID,function(F){r(F);
});}});function p(r,G,F,H){a(function(){var I;if(c.dataType==="kml"){I="xml";}else{I=c.dataType;}a.ajax({type:"GET",url:c.dataLocation+(c.dataType==="jsonp"?(c.dataLocation.match(/\?/)?"&":"?")+"callback=?":""),dataType:I,jsonpCallback:(c.dataType==="jsonp"?c.jsonpCallback:null),beforeSend:function(){if(c.callbackBeforeSend){c.callbackBeforeSend.call(this);
}if(c.loading===true){a("#"+c.formContainerDiv).append('<div id="'+c.loadingDiv+'"></div>');}},complete:function(L,K,J){if(c.callbackComplete){c.callbackComplete.call(this,L,K,J);
}if(c.loading===true){a("#"+c.loadingDiv).remove();}},success:function(M,O,J){if(c.callbackSuccess){c.callbackSuccess.call(this,M,O,J);}var L=0;var N;if(c.fullMapStart===true&&a("#"+c.mapDiv).hasClass("mapOpen")===false){N=true;
}else{B();}a("#"+c.mapDiv).addClass("mapOpen");if(c.dataType==="json"||c.dataType==="jsonp"){a.each(M,function(){var Q,R,S={};for(Q in this){R=this[Q];
if(Q==="locname"){Q="name";}else{if(Q==="web"){if(R){R=R.replace("http://","");}}}S[Q]=R;}if(!S.distance){S.distance=k.CalcDistance(r,G,S.lat,S.lng,k.EarthRadius);
}if(c.maxDistance===true&&N!==true){if(S.distance<H){s[L]=S;}else{return;}}else{s[L]=S;}L++;});}else{if(c.dataType==="kml"){a(M).find("Placemark").each(function(){var Q={name:a(this).find("name").text(),lat:a(this).find("coordinates").text().split(",")[1],lng:a(this).find("coordinates").text().split(",")[0],description:a(this).find("description").text()};
Q.distance=k.CalcDistance(r,G,Q.lat,Q.lng,k.EarthRadius);if(c.maxDistance===true&&N!==true){if(Q.distance<H){s[L]=Q;}else{return;}}else{s[L]=Q;}L++;});
}else{a(M).find("marker").each(function(){var Q={name:a(this).attr("name"),lat:a(this).attr("lat"),lng:a(this).attr("lng"),address:a(this).attr("address"),address2:a(this).attr("address2"),city:a(this).attr("city"),state:a(this).attr("state"),postal:a(this).attr("postal"),country:a(this).attr("country"),phone:a(this).attr("phone"),email:a(this).attr("email"),web:a(this).attr("web"),hours1:a(this).attr("hours1"),hours2:a(this).attr("hours2"),hours3:a(this).attr("hours3"),category:a(this).attr("category"),featured:a(this).attr("featured")};
if(Q.web){Q.web=Q.web.replace("http://","");}Q.distance=k.CalcDistance(r,G,Q.lat,Q.lng,k.EarthRadius);if(c.maxDistance===true&&N!==true){if(Q.distance<H){s[L]=Q;
}else{return;}}else{s[L]=Q;}L++;});}}function K(Q){Q.sort(function(S,R){return((S.distance<R.distance)?-1:((S.distance>R.distance)?1:0));});}K(s);if(c.featuredLocations===true){j=a.grep(s,function(R,Q){return R.featured==="true";
});y=a.grep(s,function(R,Q){return R.featured!=="true";});s=[];s=j.concat(y);}var P=(c.lengthUnit==="km")?c.kilometersLang:c.milesLang;if(c.maxDistance===true&&N!==true){if(s[0]===undefined||s[0]["distance"]>H){alert(c.distanceErrorAlert+H+" "+P);
return;}}else{if(c.distanceAlert!==-1&&s[0]["distance"]>c.distanceAlert){alert(c.distanceErrorAlert+c.distanceAlert+" "+P);}}a(function(){var ai,ae,X={};
function Y(aj){for(ai in s[aj]){ae=s[aj][ai];if(ai==="distance"){ae=u(ae,2);}X[ai]=ae;}}function S(an){Y(an.get("id"));var al;if(X.distance<=1){if(c.lengthUnit==="km"){al=c.kilometerLang;
}else{al=c.mileLang;}}else{if(c.lengthUnit==="km"){al=c.kilometersLang;}else{al=c.milesLang;}}var am=an.get("id");if(c.storeLimit===-1||c.storeLimit>26){var ak=am+1;
}else{var ak=String.fromCharCode("A".charCodeAt(0)+am);}var aj={location:[a.extend(X,{markerid:am,marker:ak,length:al,origin:F})]};return aj;}if(c.slideMap===true){h.slideDown();
}if(c.modalWindow===true){if(c.callbackModalOpen){c.callbackModalOpen.call(this);}function R(){if(c.callbackModalOpen){c.callbackModalOpen.call(this);}a("#"+c.overlayDiv).hide();
}a("#"+c.overlayDiv).fadeIn();a(document).on("click."+w,"#"+c.modalCloseIconDiv+", #"+c.overlayDiv,function(){R();});a(document).on("click."+w,"#"+c.modalWindowDiv,function(aj){aj.stopPropagation();
});a(document).on("keyup."+w,function(aj){if(aj.keyCode===27){R();}});}if((c.fullMapStart===true&&N===true)||c.zoomLevel===0){var ac={mapTypeId:google.maps.MapTypeId.ROADMAP};
var V=new google.maps.LatLngBounds();}else{var ac={zoom:c.zoomLevel,center:new google.maps.LatLng(r,G),mapTypeId:google.maps.MapTypeId.ROADMAP};}var ag=new google.maps.Map(document.getElementById(c.mapDiv),ac);
h.data("map",ag);var aa=new google.maps.InfoWindow();if(c.storeLimit===-1||(s.length-1)<c.storeLimit-1){l=s.length-1;}else{l=c.storeLimit-1;}if(c.originMarker===true&&c.fullMapStart===false){var U=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_shadow",new google.maps.Size(40,37),new google.maps.Point(0,0),new google.maps.Point(12,35));
var ab=new google.maps.LatLng(r,G);var W=new google.maps.Marker({position:ab,map:ag,icon:"http://maps.google.com/mapfiles/ms/icons/"+c.originpinColor+"-dot.png",shadow:U,draggable:false});
}for(var Z=0;Z<=l;Z++){var ah=String.fromCharCode("A".charCodeAt(0)+Z);var af=new google.maps.LatLng(s[Z]["lat"],s[Z]["lng"]);W=Q(af,s[Z]["name"],s[Z]["address"],ah);
W.set("id",Z);z[Z]=W;if((c.fullMapStart===true&&N===true)||c.zoomLevel===0){V.extend(af);}T(W);}if((c.fullMapStart===true&&N===true)||c.zoomLevel===0){ag.fitBounds(V);
}a("#"+c.listDiv+" ul").empty();a(z).each(function(aj,ak){var al=String.fromCharCode("A".charCodeAt(0)+aj);var am=z[aj];ad(am);});function ad(ak){var aj=S(ak);
var al=e(aj);a("#"+c.listDiv+" ul").append(al);}a(document).on("click."+w,"#"+c.listDiv+" li",function(){var al=a(this).data("markerid");var ak=z[al];a("#"+c.listDiv+" li").removeClass("list-focus");
a("#"+c.listDiv+" li[data-markerid="+al+"]").addClass("list-focus");ag.panTo(ak.getPosition());var aj="left";if(c.bounceMarker===true){ak.setAnimation(google.maps.Animation.BOUNCE);
setTimeout(function(){ak.setAnimation(null);T(ak,aj);},700);}else{T(ak,aj);}});a("#"+c.listDiv+" ul li:even").css("background","#"+c.listColor1);a("#"+c.listDiv+" ul li:odd").css("background","#"+c.listColor2);
function Q(aj,am,al,ap){var ao=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+ap+"|"+c.pinColor+"|"+c.pinTextColor,new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34));
var an=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_shadow",new google.maps.Size(40,37),new google.maps.Point(0,0),new google.maps.Point(12,35));
if(c.storeLimit===-1||c.storeLimit>26){var ak=new google.maps.Marker({position:aj,map:ag,draggable:false});}else{var ak=new google.maps.Marker({position:aj,map:ag,icon:ao,shadow:an,draggable:false});
}return ak;}function T(am,al){var ak=S(am);var aj=g(ak);if(al==="left"){aa.setContent(aj);aa.open(am.get("map"),am);}else{google.maps.event.addListener(am,"click",function(){aa.setContent(aj);
aa.open(am.get("map"),am);a("#"+c.listDiv+" li").removeClass("list-focus");markerId=am.get("id");a("#"+c.listDiv+" li[data-markerid="+markerId+"]").addClass("list-focus");
var an=a("#"+c.listDiv),ao=a("#"+c.listDiv+" li[data-markerid="+markerId+"]");a("#"+c.listDiv).animate({scrollTop:ao.offset().top-an.offset().top+an.scrollTop()});
});}}});}});});}}});};})(jQuery);